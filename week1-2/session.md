# session
## 개요
세션은 서버와 클라이언트(웹 브라우저)가 연결되어 있는 동안 **사용자의 상태를 유지하기 위한 기술**입니다. 웹은 본질적으로 stateless 프로토콜인 HTTP를 사용하기 때문에, 서버는 사용자가 페이지를 새로고침하거나 다른 페이지로 이동하면 그 사용자가 누구인지, 이전에 어떤 활동을 했는지 기억할 수 없습니다. 세션은 이 문제를 해결하기 위해 도입되었습니다.

1. 서버는 사용자를 식별하기 위한 고유한 세션 ID를 생성합니다.
2. 이 ID를 쿠키에 담아 클라이언트에 보냅니다.
3. 클라이언트는 이후 요청 시마다 이 쿠키를 서버로 다시 보냅니다.
4. 서버는 쿠키의 세션 ID를 이용해 해당 사용자의 상태 정보를 서버 저장소에서 찾아냅니다.

세션의 핵심: 사용자 상태 정보(로그인 여부, 장바구니 내용 등)는 **서버에 저장**되고, 클라이언트는 서버에 저장된 정보에 접근하기 위한 열쇠(세션 ID)만 가지고 있습니다.
## 세션의 종류
세션은 서버에 정보를 저장하는 방식에 따라 여러 종류로 나눌 수 있습니다.
- 서버 기반 세션 (Server-side session): 가장 일반적인 형태로, 모든 세션 데이터가 서버의 메모리, 파일 시스템, 또는 데이터베이스에 저장됩니다.
- 클라이언트 기반 세션 (Client-side session): 세션 데이터가 서버가 아닌 쿠키에 암호화된 형태로 저장됩니다. 서버 부하가 적지만, 보안적으로 취약할 수 있다는 단점이 있습니다.
## 라이프사이클
세션은 생성, 사용, 만료의 과정을 거칩니다.
- **생성**: 사용자가 웹사이트에 접속하거나 로그인할 때 서버에서 세션이 생성됩니다.
- **사용**: 사용자가 웹사이트를 이용하는 동안, 요청마다 세션 ID를 통해 세션 데이터를 읽고 씁니다.
- **만료**: 세션은 설정된 시간이 지나거나, 브라우저가 종료되거나, 사용자가 로그아웃하는 경우에 파기됩니다.
## express-session
`express-session`은 Express.js 환경에서 세션을 쉽게 관리할 수 있도록 도와주는 미들웨어입니다. 개발자가 복잡한 세션 관리 로직을 직접 구현할 필요 없이, 이 미들웨어의 옵션 설정만으로 세션 시스템을 구축할 수 있습니다.
- 세션 ID 생성 및 관리: 요청이 들어올 때마다 새로운 세션 ID를 생성하거나, 기존 세션 ID를 찾아줍니다.
- 세션 쿠키 설정: 세션 ID를 담을 쿠키를 자동으로 생성하여 클라이언트에 보냅니다. (내부적으로 `cookie-parser` 이용)
- 세션 데이터 저장: 서버 메모리나 외부 저장소(Redis, MongoDB 등)에 세션 데이터를 쉽게 저장하고 접근할 수 있게 해줍니다.
- `req.session` 객체 제공: 각 요청의 `req` 객체에 `session` 속성을 추가하여 개발자가 세션 데이터를 쉽게 읽고 쓸 수 있게 해줍니다.
## 출처
- https://developer.mozilla.org/ko/docs/Web/HTTP/Guides/Session
- https://expressjs.com/en/resources/middleware/session.html